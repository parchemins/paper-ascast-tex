
\newcommand{\algoAnd}{~\textbf{\textup{and}}~}
\newcommand{\algoOr}{~\textbf{\textup{or}}~}

\SetKwProg{Function}{func}{}{}

\small

\DontPrintSemicolon
\LinesNumbered

$O_p$, $W_p$ \tcp*[r]{set of neighbors and weights}
$A_{s, c}^{d, \pi} \leftarrow \alpha_{\infty, 0}^{\infty, \varnothing} $ \tcp*[r]{best $\alpha$ so far}
$V \leftarrow \varnothing$;~ $V[p] \leftarrow 0$ \tcp*[r]{vector of versions}

\BlankLine
\BlankLine

\Function{\textup{\texttt{Add ( )}}} { % \hfill [if $V[p]\equiv 0 \mod 2 $]} } {
  \textup{\smash{receiveAdd($p$, $\alpha_{p, V[p] + 1}^{0, \varnothing}$)}}\label{line:ascast_add}
}

\BlankLine

\Function{\textup{\texttt{Del ( )}}} { % \hfill [if $V[p]\equiv 1 \mod 2 $]} } {
  \textup{\smash{receiveDel($p$, $\delta_{p, V[p] + 1}$)}}\label{line:ascast_del}
}

\BlankLine
\BlankLine

\Function{\textup{receiveAdd($q$, $\alpha_{s', c'}^{d', \pi'}$)}}
  %\tcp*[f]{\footnotesize{receive $\alpha$ from $q$}}}
  {
    \uIf(\tcp*[f]{\footnotesize{state?}}) {\hphantom{$($}$q = \pi[|\pi| - 1] \algoAnd$\tcp*[f]{{\footnotesize{$\alpha$ and $A$ come from $q$?}}}\\
    \hphantom{\textbf{if}} $(c' < V[s'] \,\, \algoOr$\tcp*[f]{\footnotesize{history?}\label{line:ascast_version}}\\
    \hphantom{\textbf{if}} \smash{$(\alpha_{s', c'}^{d', \pi'} > A_{s, c}^{d, \pi} \algoAnd  p\not\in \pi'))$}\label{line:detectA}} {
        \textup{receiveDel($q$, $\delta_{s, c}^{\pi}$)} \tcp*[r]{\footnotesize{III detect}}
    }
    \uElseIf {$A_{s, c}^{d, \pi} < \alpha_{s', c'}^{d', \pi} \algoAnd p \not\in \pi'$  } {
          $V[s'] \leftarrow c'$ \;
          $A_{s, c}^{d, \pi} \leftarrow \alpha_{s', c'}^{d', \pi'}$ \;
          \ForEach{$n \in O_p$} {
            send$_n$(\smash{$\alpha_{s', c'}^{d' + W_{pq}, \pi' \cup p}$)}\tcp*[r]{\footnotesize{I propagate}\label{line:ascast_better}}
          }

     }
}



\BlankLine

\Function{\textup{receiveDel($q$, $\delta_{s', c'}^{\pi'}$)}
%  \tcp*[f]{\footnotesize \smash{$r_p (\delta_{s', c'})$ \textup{\texttt{or}} $r_p (\delta_{s', c'}^{\pi'})$}}
} {
  \uIf {$((\delta_{s', c'} \algoAnd \alpha_{s', c'-1} = A_{s, c})  \algoOr$
    \tcp*[f]{\footnotesize{$\delta$ received}}\\
    \hphantom{\textbf{if} } $(\delta_{s',c'}^{\pi'}  \algoAnd  \alpha_{s', c'}^{\_, \pi'} = A_{s, c}^{\_, \pi}))  \algoAnd$ \tcp*[f]{\footnotesize{$\delta?$ received}}\\
    \hphantom{\textbf{if} $($} $p \not\in \pi'$ \label{line:notloopingB}} {
     $V[s'] \leftarrow \max(V[s'], c')$ \;
     $A_{s, c}^{d, \pi} \leftarrow \alpha_{\infty, 0}^{\infty, \varnothing}$ \;

    \ForEach{$n \in O_p$}{
      \lIf(\tcp*[f]{\footnotesize{I' propagate}}) {\smash{$\delta_{s', c'}$}} {
        send$_n$(\smash{$\delta_{s', c'}$)}
      } 
      \hphantom{\textbf{if} $\delta_{s', c'}^{\pi'}$}~\textbf{else} send$_n$(\smash{$\delta_{s', c'}^{\pi'\cup p}$)} \tcp*[f]{\footnotesize{IV propagate}}
    }

  }\uElseIf{$A_{s, c}^{d, \pi} \neq \alpha_{\infty, 0}^{\infty, \varnothing}$} {
     \textup{send$_q$($\alpha_{s, c}^{d + W_{pq}, \pi \cup p}$)}
     \tcp*[r]{\label{line:ascast_compete}\footnotesize{compete using $A$}}
  }
}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../paper"
%%% ispell-local-dictionary: "english"
%%% End: 
