
\section{Background and motivation}
\label{sec:background}

Fog infrastructures are distributed systems comprising heterogeneous
machines interconnected by communication links.

\begin{definition}[Fog infrastructure]
  A fog infrastructure is a \underline{g}raph $G(V, E)$ of
  \underline{v}ertices $V$ and bidirectional \underline{e}dges $E \in
  V \times V$. Edges have symmetric \underline{w}eights $w_{ij} =
  w_{ij}$ with $i, j \in V$.
\end{definition}

\begin{definition}[Logical partition]
  A logical \underline{p}artition $P_s$ originated at a
  \underline{s}ource process $s \in V$ is a set of interconnected
  processes that do not belong to another logical partition. The set
  of sources is $S$.
\end{definition}

\begin{definition}[Optimal partitioning]
  The optimal partitioning $\mathcal{P}$ is a set of logical
  partitions such that each process belongs to a logical partition
  comprising its closest source process. $\forall p \in P_{s_1\in S},
  \nexists P_{s_2 \in S}$ such that \TODO{$distance(p, s_2) <
    distance(p, s_1)$}.
\end{definition}

When $distance$ involves latency or number of hops between sources and
processes, the optimal partitioning consists in processing the
multiple destinations shortest path~\REF at each process.


\begin{definition}[Shortest path]
  A \underline{p}ath $\pi_{ij}$ from Process $i$ to Process $j$ is a
  sequence of vertices $[i, k_1, k_2, \ldots k_n, j]$ with $\forall
  0\leq m \leq n, \langle \pi_{ij}[m], \pi_{ij}[m+1] \rangle \in
  E$. Shortest \underline{p}aths $\Pi_{ij}$ are sets of paths such
  that there exists no lower sum of weights from $i$ to $j$.
\end{definition}

\TODO{Define operation alpha. Receipt and deliveries.}

Without global knowledge, processes only rely on their own behavior to
deduce the behavior of their neighbor processes. 

\begin{definition}[\label{def:pathdelivery}\TODO{Shortest path} delivery]
  \TODO{Shortest path} delivery ensures the system eventually converges to
  optimal partitioning:
  \begin{inparaenum}[(i)]
  \item (\textbf{termination}) processes do not need to propagate
    operations they do not deliver: $\forall \langle i, j \rangle \in
    E, \neg d_i(\alpha_{s}^w)\implies \neg
    d_j(\alpha_{s}^{w+w_{ij}})$;
  \item (\textbf{propagation}) operations delivered by a process may
    also benefit neighbor processes: $\forall \langle i, j \rangle \in
    E, d_i(\alpha_{s}^{w_1}) \implies
    d_j(\alpha_{s}^{w_1+w_{ij}}) \vee
    d_j(\alpha_{*}^{w_2 < w_1 + w_{ij}})$.
  \end{inparaenum}
\end{definition}


\begin{figure*}
  \begin{center}
    \subfloat[Part A][\label{fig:addA}Both Process $a$ and
      Process $c$ initiate a partition.
      $w_{ab} = 1.5$; $w_{bc} = w_{cd} = w_{bd} = 1$.]{\input{input/figaddA.tex}}
    \hspace{5pt}
    \subfloat[Part B][\label{fig:addB}Messages transit through communication
      links and carry increasing weights.]{\input{input/figaddB.tex}}
    \hspace{5pt}
    \subfloat[Part C][\label{fig:addC}Process $b$ receives and forwards
      $\alpha_{c}^{1}$ then discards $\alpha_{a}^{1.5}$, for the latter distance
      is higher.]{\input{input/figaddC.tex}}
    \hspace{5pt}
    \subfloat[Part D][\label{fig:addD}Processes $b$, $c$, and $d$ discard
      incoming messages. The system converged to optimal partitions.]{
      \input{input/figaddD.tex}}
    \caption{\label{fig:add}Simple accumulation in messages makes the
      system converge to optimal partitions with contained
      broadcast.}
  \end{center}
\end{figure*}

\begin{algorithm}
  \input{input/algoadd.tex}
  \caption{\label{algo:add}Adding a partition by Process $p$.}
\end{algorithm}


Algorithm~\ref{algo:add} shows the instructions that implement the
rules of Definition~\ref{def:pathdelivery} to converge towards optimal
partitioning. Figure~\ref{fig:add} illustrates its behavior on a
system comprising 4 processes $a$, $b$, $c$, and $d$. Two processes
$a$ and $c$ concurrently create a partition. They initialize their own
state with the lowest possible bound $0$ (see
Line~\ref{line:lowestbound}), and send a message to each of their
neighbors by accumulating the corresponding edge weight (see
Line~\ref{line:accumulator}). In Figure~\ref{fig:addC}, Process $b$
receives $\alpha_{c}^{1}$. Since it improves its own partition
distance, it keeps it and forwards it to its neighbors. Process $b$
discards $\alpha_{b}^{1.5}$, for it does not improve its partition
distance. Processes $c$ and $d$ will never hear of Process $a$'s
partition. At scale, it saves bandwidth by limiting generated traffic
to subsets of processes. In Figure~\ref{fig:addD}, processes discard
last transiting messages. The system converged to the optimal
partitioning. Interestingly, while the receipt order of messages does
not impact on local control information, it impacts on control
information broadcast in the network. \TODO{explain with r() d() b().}

Transitive relationships ensure that each process gets its closest
source while accumulation of weights ensures that messages propagation
terminates.  Removals of partitions are more
challenging. \TODO{Figure.} \TODO{Also easy to solve when all
  processes receive all messages}. One could solve this issue by
removing partitions that were not advertised for a defined
time~\REF. However, relying on physical timeout could lead to either
premature removals of partitions when they are still operating; or
slow convergence where processes believe they belong to a partition
that was removed.


\begin{figure*}
  \begin{center}
    \subfloat[Part A][\label{fig:delA}Both Process $a$ and
      Process $c$ initiate then remove a partition.
      $w_{ab} = 1.5$; $w_{bc} = w_{cd} = w_{bd} = 1$.]{\input{input/figdelA.tex}}
    \hspace{5pt}
    \subfloat[Part B][\label{fig:delB}Process $b$ and Process $d$ receive and deliver
      messages based on their weights. $a$'s partition propagates to all processes.]
             {\input{input/figdelB.tex}}
    \hspace{5pt}
    \subfloat[Part C][\label{fig:delC}Process $c$'s partition reach $b$ and $d$.
      Its removal shortly follows. Process $b$ does not have any control
      information about partitions any more.]{\input{input/figdelC.tex}}
    \hspace{5pt}
    \subfloat[Part D][\label{fig:delD}Processes discard remaining messages.
      Process $b$ does not deliver $\delta_a$, for it already removed $a$ when
      Partition $c$ dominated it. Processes $c$ and $d$ remain in an incorrect
      partition.]{\input{input/figdelD.tex}}
  \end{center}
  \caption{\label{algo:add}Removing partition may lead to inconsistent partitions.}
\end{figure*}



Order on the broadcast.

\TODO{Problem statement.}

\TODO{Next Section presents our approach that solves this problem
  statement by relying only on logical control information.}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../paper"
%%% ispell-local-dictionary: "english"
%%% End: 

